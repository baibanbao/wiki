<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML+RDFa 1.0//EN"
    "http://www.w3.org/MarkUp/DTD/xhtml-rdfa-1.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
      xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
      xmlns:dc="http://purl.org/dc/elements/1.1/"
      xmlns:foaf="http://xmlns.com/foaf/0.1/">
  
  <head>
    
    
      
        <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
      
      
      <title>
        [大妈吐糟] 虾米音乐的系列猜想 |
        Zoom.Quiet Personal Static Wiki 
      </title>
      
      
        <!-- YUI CSS reset, fonts, base -->
        <link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/combo?3.0.0/build/cssreset/reset-min.css&amp;3.0.0/build/cssfonts/fonts-min.css&amp;3.0.0/build/cssbase/base-min.css" media="screen, projection" />
        
        <link rel="stylesheet" type="text/css" href="../media/css/custom.css" media="screen, projection" />
        <link rel="stylesheet" type="text/css" href="../media/css/style.css" media="screen, projection" />
        <link rel="stylesheet" type="text/css" href="../media/css/pygments.css" media="screen, projection" />
      
      
      
      
      
        
          <!-- Google Analytics -->
          <script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-2331528-6']);
            _gaq.push(['_trackPageview']);
            (function() {
              var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
              ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
            })();
          </script>
        
      
    
  </head>
  
  <body >
    
      
      
    
<div class="site-logo">
  <img src="http://zoomq.qiniudn.com/logos/zq-eyes-IMG_1987-64x64.JPG?imageView2/2/w/32" />
  </div>

        
          
  
    <ol id="breadcrumbs">
      
        <li class="crumb-0 not-last">
          
            <a href="../">index</a>
          
        </li>
      
        <li class="crumb-1 not-last">
          
            <a href="./">IMHO</a>
          
        </li>
      
        <li class="crumb-2 last">
          
            150205-xiami-chaos
          
        </li>
      
    </ol> <!-- ol#breadcrumbs -->
  

        
      
      
      <div id="content">
        
        
        
        <h1 id="_1">[大妈吐糟] 虾米音乐的系列猜想</h1>
<div class="toc">
<ul>
<li><a href="#_1">[大妈吐糟] 虾米音乐的系列猜想</a><ul>
<li><a href="#_2">背景</a></li>
<li><a href="#_3">现象</a></li>
<li><a href="#_4">问题</a><ul>
<li><a href="#_5">分析</a><ul>
<li><a href="#mp3-meta">MP3 meta信息</a></li>
<li><a href="#_6">但是!</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_7">建议</a></li>
<li><a href="#_8">进展</a></li>
</ul>
</li>
</ul>
</div>
<h2 id="_2">背景</h2>
<p>习惯泛听的<code>专辑顺序强迫症重症患者</code>!</p>
<ul>
<li>喜欢复合类型的音乐,追踪创作型音乐人/团队</li>
<li>只听专辑,而且一定要按顺序来听</li>
<li>习惯根据当前心态快速形成有针对性的播放列表</li>
</ul>
<p>音乐历史:</p>
<ul>
<li>从有条件配置录音机开始</li>
<li>上百盒带,几百CD,MP3CD</li>
<li>硬盘常备 30G+ APC</li>
<li>以往移动音乐习惯:<ul>
<li>iOS 用 podcast 下载有关频道的音乐</li>
<li>Android 用自行上传的音乐,以 <code>类别/音乐人/专辑</code> 为目录形式组织</li>
<li>用内置播放器以目录为线索播放</li>
<li>管理/播放 流程继续电脑中 <a href="http://cmus.github.io/">cmus</a> 的习惯</li>
</ul>
</li>
<li>为制作 <a href="http://momoko.in/family/family-timeline.html">大小丸子🐒:"情人节快乐;-)"</a> 才知道 xiami <ul>
<li>变成移动音乐主力陪伴平台</li>
<li>下载过 900+ 专辑</li>
<li>播放 20000+ 首音乐</li>
</ul>
</li>
</ul>
<h2 id="_3">现象</h2>
<p>实际上定心使用 xiami 音乐应用,也经过了很长时间的折腾:</p>
<ul>
<li>从 Play 市场上安装了所有高分音乐播放器, 没有一个超过 winamp 的尿性</li>
<li>从 碗豆茄 下载安装了所有高分音乐应用, 发现都一个尿性:<ul>
<li>在播放界面中没有当前播放列表的快速入口</li>
<li>播放清单界面没有专辑封面缩图</li>
<li>无法从当前播放快速进入 专辑/艺人/相关艺人 页面,并进行快速下载</li>
<li>只有乱序播放,没有顺序播放的快捷方式</li>
<li>...</li>
</ul>
</li>
<li>相比下来,只有 xiami 还能忍受</li>
<li>但是,当本地音乐 下载3000+音乐, 艺人超过5屏,专辑超过100时</li>
<li>各种杯具开始了:<ul>
<li>下载/播放/删除 同时进行时,闪退</li>
<li>任何界面中,批量删除时,闪退, 恢复时总是删不干净</li>
<li>经常专辑/艺人封面丢失, 一片空白无法要求强行同步/重新下载</li>
<li>批量操作,经常定住,无反应</li>
<li>每次启动,进入本地音乐界面时,有一定比例闪退</li>
<li>每次启动进入本地音乐时, 每次都要消耗几十秒重新加载</li>
<li>...</li>
</ul>
</li>
</ul>
<h2 id="_4">问题</h2>
<p>基本上,俺对手机上的音乐品质已经不报希望了,
只要求:</p>
<ul>
<li>可以快速选中想听的艺人</li>
<li>能快速追加其它下载的指定艺人所有专辑到当前播放清单中</li>
<li>快速按照下载的专辑以及专辑内顺序依次播放</li>
</ul>
<p>但是,以上三个基本需求,无一能在当前已知所有移动播放器中作到:</p>
<ul>
<li>选择艺人, 只有 Google Play音乐 基本作到舒心了:<ul>
<li><img alt="150205-gplayer-lib.png(PNG 图像,370x489 像素)" src="http://zoomq.qiniudn.com/ZQCollection/snap/150205-gplayer-lib.png" /></li>
<li>点击进入 <code>我的乐库</code> 优先进入 音乐人, 而不是 其它 tab</li>
<li>所有卡片用的是现有专辑的拼贴</li>
<li>杯具的是, 从本地导入音乐的过程,以及目录 是无法控制的</li>
<li>如果通过其它应用删除了相关音乐, GPlayer 是不知道何时能更新的</li>
</ul>
</li>
<li>快速根据需要组合出当前播放清单, 没有应用能满足:<ul>
<li>多数强行要求创建 播放列表/精华 没有7次以上的操作不可能完成</li>
<li>xiami 还限定只能有 50 首音乐的上限制</li>
<li>这就很杯具了: 俺播放本地的音乐,为毛要限制俺的 playlist 长度?!</li>
</ul>
</li>
<li>按照一张专辑接一张专辑,音乐依从专辑原有顺序播放<ul>
<li>这应该是最吻合音乐人当初创意的音乐收听顺序了</li>
<li>但是,这竟然成为所有 音乐类应用 最不愿意实现的功能?!</li>
<li>为什么呢?! 细思恐极....</li>
</ul>
</li>
</ul>
<h3 id="_5">分析</h3>
<h4 id="mp3-meta">MP3 meta信息</h4>
<p>参考:</p>
<ul>
<li><a href="http://tools.ietf.org/html/rfc3003">RFC 3003 - The audio/mpeg Media Type</a></li>
<li><a href="http://tools.ietf.org/html/rfc3119">RFC 3119 - A More Loss-Tolerant RTP Payload Format for MP3 Audio</a></li>
<li><a href="http://en.wikipedia.org/wiki/ID3">ID3 - Wikipedia, the free encyclopedia</a></li>
<li><a href="http://en.wikipedia.org/wiki/MP3#ID3_and_other_tags">MP3 - Wikipedia, the free encyclopedia</a></li>
<li>...</li>
</ul>
<p>从 mpeg-1 时代开始, 音乐文件中就已经能包含完备的专辑/艺人/播放顺序 的信息!</p>
<h4 id="_6">但是!</h4>
<p>xiami 也好,其它音乐应用也好, 走的都是 ucg 模式,以便避开版权纠纷;</p>
<ul>
<li>这就导致各家音乐库中的音乐文件本身 meta 信息混乱/不全</li>
<li>进一步的,为了避免在移动设备上进行大量的目录操作, 大家都将下载文件放在一个目录中</li>
<li>更加可悲的, 为了快速开发使用 SQLite 来管理所有音乐 meta 信息</li>
<li>综上, 导致了:<ul>
<li>无法合理的触发 下载/meta提取/刷新/使用 时机</li>
<li>人为形成多重等待</li>
<li>并在错误的信息基础上,几乎无法进行合理的控制识别</li>
</ul>
</li>
<li>最终形成类似情景:<ul>
<li><img alt="150205-xiami-local-chaos.jpg(JPEG 图像,720x1280 像素) - 缩放 (59%)" src="http://zoomq.qiniudn.com/ZQCollection/snap/150205-xiami-local-chaos.jpg?imageView2/2/w/360" /></li>
<li>根据音乐人信息, 从专辑列表,下载多个专辑后</li>
<li>在音乐人界面, 看到的就是这种专辑顺序混杂的情景</li>
<li>实际播放时,可以想象是多么难受的事儿</li>
</ul>
</li>
<li>xiami 中还有一个诡异的现象是:<ul>
<li>即使相关专辑都下载到了本地</li>
<li>但是,在一个专辑播放过程中</li>
<li>动态的从其它本地专辑界面,点击加入当前播放列表后</li>
<li>当播放追加专辑音乐时, xiami 不从本地播放,而是无视音乐已经下载的状态,尝试从网络中下载播放!</li>
<li>这得是什么样的脑洞经理,才作的出这种产品决策呢...</li>
</ul>
</li>
</ul>
<h2 id="_7">建议</h2>
<ul>
<li>基于用户上传的音乐文件表直接使用:<ul>
<li>根据官方的信息, 在服务端统一刷一下 meta 信息吧</li>
<li>并将相关 meta 信息,独立保存一下</li>
<li>在其它用户下载音乐文件的同时, 直接向客户端 push 对应的meta 信息, 就别生从本地文件中再遍历读取了吧</li>
</ul>
</li>
<li>下载/管理/播放, 用多线程/进程来处理吧<ul>
<li>最简单的,别将 meta 信息和其它控制信息放在同一 DB 中哪</li>
</ul>
</li>
<li>SQLite 这货就是单用户单线程最轻量级DB<ul>
<li>对于这种专辑信息,又不涉及交叉关系索引</li>
<li>就是用个内存 KV 效率也比用 SQL 高哪</li>
</ul>
</li>
</ul>
<p>总之, 亲, 大家喜欢 xiami 的音乐库, 努磨 SD 卡拼命下载了几千音乐到本地了</p>
<p>就让俺们愉快的自由播放 ,不好嘛?!</p>
<h2 id="_8">进展</h2>
<ul>
<li>150205 整理以往的吐糟, 结集纪念发布,永备,看 xiami 何时修订上</li>
<li>141121 <a href="http://www.xiami.com/g/thread-918973?spm=0.0.0.0.aq4pjq">[大妈吐糟] 自杀现象分析 - 虾米音乐讨论区</a></li>
<li>141030 <a href="http://www.xiami.com/g/thread-917351?spm=0.0.0.0.aq4pjq">[大妈吐糟] 无法理解的本地播放行为! - 虾米音乐讨论区</a></li>
</ul>
        
        
        
        
        <hr class="clear" />


    Author: <a href="http://zoomquiet.io">
    <img
      class="after"
      src="http://zoomq.qiniudn.com/logos/zq-eyes-IMG_1987-64x64.JPG"
      alt="Zoom.Quiet"
      width="32"
      height="32"
    />
    </a>
      <i>
        /<a href="mailto:i@zoomquiet.io">mail</a>
      </i>
    <b>
      /<a href="mailto:https://www.gittip.com/ZoomQuiet/">
        gittip
        </a>
    </b>
    <i>
        /<a href="https://github.com/ZoomQuiet">
          github
          </a>
      </i>

<br/>


      </div> <!-- div#content -->
      
      
      <div id="footer">
        <p>
          
            Zoom.Quiet Personal Static Wiki |
          
          
          <a href="_list.html">ls ./</a>
          | 
          Powered by <a href="http://markdoc.org/">Markdoc</a>
          + <a href="https://gitcafe.com/wiki4zq/markdoc4zq">gitcafe</a>
          + <a href="http://www.qiniu.com/about">七牛</a>

        </p>

      </div>
      
    
    
    
    <hr class="clear" />



    <div id="disqus_thread"></div>

    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'wikizoomquietio'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



  </body>
</html>